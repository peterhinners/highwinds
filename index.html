<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Route Optimizer</title>

  <link rel="stylesheet" href="application.css">

  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>

<body>
  <div id="destination">
    <form id="yoyoma" action="javascript:myFunction();">
      <input type="text" size="50" placeholder="Client Address">

      <select id="mySelect">
        <option value="" disabled selected>Server Address
        <option value="nyc">Switch and Data - 111 8th Ave, New York, NY 10011
        <option value="dc">Equinix, Cage 1010 - 21715 Filigree Ct., Ashburn VA 20147
        <option value="atlanta">UseNetServer Fourth Floor - 56 Marietta St., Atlanta, GA 30303
        <option value="dallas">Dallas,"1950 Stemmons Frwy"
        <option value="losAngeles">One Wilshire Bldg., 11th Fl, Cage C1111 - 624 S. Grand Ave, Los Angeles, CA 90017
        <option value="chicago">Equinix - 350 E Cermak Rd, Chicago, IL 60616
        <option value="seattle">2001 Sixth Ave, Seattle WA, 98121
        <option value="miami">50 Northeast 9th Street, Miami, FL
      </select>

      <input type="submit" value="Optimal Route">

    </form>
  </div>





<!--   <div id="demo"></div> -->



   <div id="map"></div>


  <script src="graph.js"></script>
  <script src="application.js"></script>

  <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAT__AymaDYqLmALnKweZ1tacPJMwzWjMo&callback=initMap&libraries=geometry">
  </script>

  <script>

    var lastPolyline;
    var clientMarker;
    var serverLocation;

    function reset(line, marker) {
      line.setMap(null);
      marker.setMap(null);
    }



    function myFunction() {



     if (lastPolyline){
      reset(lastPolyline, clientMarker);
     }

    serverLocation = document.getElementById("mySelect").value;
    var y = document.getElementById("yoyoma").elements[0].value;


    if (y === ""){
      alert("Please enter in client address");
      } else if (serverLocation === "") {
      alert("Please choose a server location.");
      } else {
        geocodeAddress(y);
      }



    }



    function geocodeAddress(address)
    {
      var client;
      geocoder.geocode( {address:address}, function(results, status)
      {
        // console.log(client.lat());
        if (status == google.maps.GeocoderStatus.OK)
        {
          // map.setCenter(results[0].geometry.location);
          clientMarker = new google.maps.Marker(
          {
              map: map,
              position: results[0].geometry.location
          });
          client = clientMarker.position;
          findNearestPOP(client);
        } else {
          alert('Google Maps Geocoder could not find your address, please try again. ' + status);
       }
      });
    }

    function findNearestPOP(client){
      // console.log(typeof client);
      var clientLat = client.lat();
      var clientLng = client.lng();
      var pops = [
        nyc,
        chicago,
        seattle,
        dc,
        atlanta,
        dallas,
        losAngeles,
        miami
      ];



      var closest = [40075161, ""]; // earth's circumference in meters, and placeholder

      for (var i = 0; i < pops.length; i++){
        var distanceBetween = google.maps.geometry.spherical.computeDistanceBetween(client, pops[i]);
        if (distanceBetween < closest[0]){
          closest[0] = distanceBetween;
          closest[1] = pops[i];
        }
      }



      var nearestPopLat = closest[1].lat();
      var nearestPopLng = closest[1].lng();



      var hog = "miami";



  switch (closest[1].lat()) {
    case 40.740957:
        var startingPoint = "nyc";
        break;
    case 39.016363:
        var startingPoint = "dc";
        break;
    case 33.755464:
        var startingPoint = "atlanta";
        break;
    case 32.800340:
        var startingPoint = "dallas";
        break;
    case 34.047908:
        var startingPoint = "losAngeles";
        break;
    case 41.853895:
        var startingPoint = "chicago";
        break;
    case 47.614358:
        var startingPoint = "seattle";
        break;
    case 25.782360:
        var startingPoint = "miami";
        break;
  }





      var dijkstraMap = {nyc:{dc:219,chicago:711},chicago:{seattle:1736,nyc:711},seattle:{chicago:1736,losAngeles:962},dc:{nyc:219,atlanta:530},atlanta:{dc:530,miami:606,dallas:721},dallas:{atlanta:721,miami:1112,losAngeles:1238},losAngeles:{dallas:1238,seattle:962},miami:{atlanta:606,dallas:1112}};
      var graph = new Graph(dijkstraMap);
      var result = (graph.findShortestPath(startingPoint, serverLocation));
      var objectifiedResult = result.map(function(str){
        return eval("("+str+")");
      })




      var holdingArray = [{lat: clientLat, lng: clientLng}];
      for (var i = 0; i < objectifiedResult.length; i++){
        holdingArray.push({lat: objectifiedResult[i].lat(), lng: objectifiedResult[i].lng()});
      }

      var testLineCoordinates = holdingArray;




      lastPolyline = new google.maps.Polyline({
        path: testLineCoordinates,
        geodesic: true,
        strokeOpacity: 1,
        strokeColor: '#FF0000',
        map: map
      });




    }

    function findOptimalRoute(){

    }

</script>







</body>
</html>