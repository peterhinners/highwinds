<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Route Optimizer</title>

  <link rel="stylesheet" href="application.css">

  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>

<body>
  <div id="destination">
    <form id="yoyoma" action="javascript:myFunction();">
      <input type="text" size="50" placeholder="Client Address">

      <select id="mySelect">
      <option value="" disabled selected>Server Address
      <option value="New York">Switch and Data - 111 8th Ave, New York, NY 10011
      <option value="DC">Equinix, Cage 1010 - 21715 Filigree Ct., Ashburn VA 20147
      <option value="Atlanta">UseNetServer Fourth Floor - 56 Marietta St., Atlanta, GA 30303
      <option value="Dallas">Dallas,"1950 Stemmons Frwy"
      <option value="Los Angeles">One Wilshire Bldg., 11th Fl, Cage C1111 - 624 S. Grand Ave, Los Angeles, CA 90017
      <option value="Chicago">Equinix - 350 E Cermak Rd, Chicago, IL 60616
      <option value="Seattle">2001 Sixth Ave, Seattle WA, 98121
      <option value="Miami">50 Northeast 9th Street, Miami, FL
    </select>

  <input type="submit" value="Optimal Route">

    </form>
  </div>





  <div id="demo"></div>



   <div id="map"></div>


  <script src="graph.js"></script>
  <script src="application.js"></script>

  <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAT__AymaDYqLmALnKweZ1tacPJMwzWjMo&callback=initMap&libraries=geometry">
  </script>

  <script>

    var lastPolyline;
    var clientMarker;

    function reset(line, marker) {
      line.setMap(null);
      marker.setMap(null);
    }



    function myFunction() {

     if (lastPolyline){
      reset(lastPolyline, clientMarker);
     }

    var x = document.getElementById("mySelect").value;
    var y = document.getElementById("yoyoma").elements[0].value;
    document.getElementById("demo").innerHTML = y + " " + x;
    console.log(y + " " + x);
    if (y === ""){
      alert("Please enter in client address");
      } else if (x === "") {
      alert("Please choose a server location.");
      } else {
        geocodeAddress(y);
      }



    }



    function geocodeAddress(address)
    {
      var client;
      geocoder.geocode( {address:address}, function(results, status)
      {
        // console.log(client.lat());
        if (status == google.maps.GeocoderStatus.OK)
        {
          // map.setCenter(results[0].geometry.location);
          clientMarker = new google.maps.Marker(
          {
              map: map,
              position: results[0].geometry.location
          });
          client = clientMarker.position;
          findNearestPOP(client);
        } else {
          alert('Google Maps Geocoder could not find your address, please try again. ' + status);
       }
      });
    }

    function findNearestPOP(client){
      // console.log(typeof client);
      var clientLat = client.lat();
      var clientLng = client.lng();
      var pops = [
        nyc,
        chicago,
        seattle,
        dc,
        atlanta,
        dallas,
        losAngeles,
        miami
      ];

      var popStringHash = {
        nyc: "nyc",
        chicago: "chicago",
        seattle: "seattle",
        dc: "dc",
        atlanta: "atlanta",
        dallas: "dallas",
        losAngeles: "losAngeles",
        miami: "miami"
      };

      console.log(popStringHash.nyc);

      var closest = [40075161, ""]; // earth's circumference in meters, and placeholder

      for (var i = 0; i < pops.length; i++){
        var distanceBetween = google.maps.geometry.spherical.computeDistanceBetween(client, pops[i]);
        if (distanceBetween < closest[0]){
          closest[0] = distanceBetween;
          closest[1] = pops[i];
        }
      }

      // var funny = popStringHash.closest[1];

      // console.log(closest);

      var nearestPopLat = closest[1].lat();
      var nearestPopLng = closest[1].lng();
      // var closestPopToString = JSON.stringify(closest[1]);
      console.log(closest[1]);


      var hog = "miami";


      var dijkstraMap = {nyc:{dc:219,chicago:711},chicago:{seattle:1736,nyc:711},seattle:{chicago:1736,losAngeles:962},dc:{nyc:219,atlanta:530},atlanta:{dc:530,miami:606,dallas:721},dallas:{atlanta:721,miami:1112,losAngeles:1238},losAngeles:{dallas:1238,seattle:962},miami:{atlanta:606,dallas:1112}};
      var graph = new Graph(dijkstraMap);
      var result = (graph.findShortestPath(hog, 'chicago'));
      var objectifiedResult = result.map(function(str){
        return eval("("+str+")");
      })

      // var str = result[0];
      // var obj=eval("("+str+")");
      console.log(result);

      // var holdingArray = [{lat: nearestPopLat, lng: nearestPopLng}];
      var holdingArray = [];
      for (var i = 0; i < objectifiedResult.length; i++){
        holdingArray.push({lat: objectifiedResult[i].lat(), lng: objectifiedResult[i].lng()});
      }

      var testLineCoordinates = holdingArray;


      // var testLineCoordinates = [
      //   {lat: clientLat, lng: clientLng},
      //   {lat: nearestPopLat, lng: nearestPopLng}
      // ];

      lastPolyline = new google.maps.Polyline({
        path: testLineCoordinates,
        geodesic: true,
        strokeOpacity: 1,
        strokeColor: '#FF0000',
        map: map
      });

      // console.log(nyc);


    }

    function findOptimalRoute(){

    }

</script>







</body>
</html>